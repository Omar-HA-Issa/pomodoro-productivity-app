# Pomodoro Productivity App

A full-stack productivity application implementing the Pomodoro Technique with focus timers, session templates, scheduling, AI insights, and full DevOps automation using Azure DevOps Pipelines.

## Features

- **Focus Timer** – Cycles between focus/break intervals  
- **Session Templates** – Create and reuse Pomodoro presets  
- **Calendar Scheduling** – Plan sessions for specific dates  
- **Dashboard** – Track streaks, stats, daily schedule  
- **Insights** – AI sentiment analysis on completed sessions  
- **Azure Health Check & Monitoring** – `/health` endpoint + Prometheus-style metrics  
- **CI/CD via Azure DevOps** – Automated tests, coverage gates, Docker builds, and Azure deployment

---

## Tech Stack

### **Backend**
- Node.js  
- Express  
- SQLite  
- Supabase Auth  
- Jest (70%+ coverage)  
- Prometheus client  
- Dockerized for deployment

### **Frontend**
- React  
- TypeScript  
- React Router  
- Context API  

### **DevOps**
- Azure DevOps CI Pipeline (backend + frontend)
- Azure DevOps CD Pipeline
- Dual Docker container build (backend + frontend)
- Azure Container Registry (ACR)
- Two Azure Web Apps for Containers (API + Frontend)
- Prometheus metrics integration

---

## Prerequisites

- Node.js (v16+)  
- npm  
- Docker  
- Azure DevOps project (for CI/CD)

---

## Installation & Run

### 1. Clone the Repository
```bash
git clone https://github.com/Omar-HA-Issa/pomodoro-productivity-app.git
cd pomodoro-productivity-app
```

---

### 2. Environment & Setup
This project includes `.env.example` templates for both the backend and frontend.  

Follow these steps to set up your environment variables:

1. **Copy the templates:**
   - `backend/.env.example` → create `backend/.env`
   - `frontend/.env.example` → create `frontend/.env`

2. **Fill in the values** from each `.env.example` into your new `.env` files.

---

### 3. Install Dependencies & Run

**Backend Setup:**
```bash
cd backend
npm install
npm start
```

**Frontend Setup:**
```bash
cd frontend
npm install
npm start
```

Once both servers are running, open your browser and check that:

- Frontend runs at: http://localhost:5173  
- Backend runs at: http://localhost:8000  

---

### 4. Run Tests

```bash
cd backend
npm test
```
This will run Jest with coverage reporting.

--- 

## CI/CD with Azure DevOps

This project uses **Azure DevOps Pipelines** for full automation of CI, CD, containerization, and deployment.  
Both the backend and frontend are validated, built, and deployed from a single pipeline defined in `azure-pipelines.yml`.

---

## Continuous Integration (CI) Pipeline

The CI stage validates both the backend and frontend before any deployment occurs:

- Install backend dependencies (`npm ci`)
- Run Jest tests with full coverage
- Enforce minimum **70% coverage**
- Build the backend
- Install frontend dependencies
- Build the production React frontend

The CI stage contains two jobs: **Backend_CI** and **Frontend_CI**, both defined inside `azure-pipelines.yml`.

---

## Continuous Deployment (CD)

The CD pipeline automatically deploys both backend and frontend containers when changes are pushed to the `main` branch.

### **Docker Build & Push**
- The backend image is built using `backend/Dockerfile`, tagged, and pushed to Azure Container Registry (ACR).
- The frontend image is built using `frontend/Dockerfile` with a `VITE_API_BASE` build argument, then pushed to ACR.

### **Azure Deployment**
Two Azure Web Apps are updated:
- **pomodoroapp** → Backend Web App (Node.js API)
- **pomodoroapp-frontend** → Frontend Web App (React + Nginx)

The pipeline sets and updates container images via Azure CLI, applies CORS settings, and restarts both apps.

### **Secrets**
All ACR credentials, keys, and environment variables are stored in **Azure DevOps Variable Groups**.

---

## Docker & Deployment

Both the backend and frontend are fully containerized.

### **Local Development (docker compose)**

```bash
docker compose up --build
Backend: http://localhost:3001
Frontend: http://localhost:8080
```

- The backend is now reachable at: `http://localhost:8000`
- Azure DevOps pipelines automatically run these same steps during deployment.

---

## Monitoring & Health Checks
  
### */health* Endpoint

Returns the application's live status:

```bash
{
  "status": "ok",
  "ok": true,
  "uptime": 123.45,
  "timestamp": "2025-11-15T21:29:25.412Z"
}
```

---

## Metrics Endpoint (Prometheus):

Exposes the following monitoring metrics:

1) Request count
2) Request latency
3) Error count

These metrics can be scraped by Prometheus or connected to Grafana dashboards.

---

## File Structure

**Backend:**
- `routes/` - API endpoints (sessions, timer, schedule, dashboard, insights)
- `tests/` - Jest test files 
- `middleware/` - Authentication middleware
- `database.js` - SQLite + Supabase setup
- `pomodoro.db` - SQLite database generated by `database.js` for use in the entire app
- `server.js` - Express app
- - `backend/Dockerfile` – Multi-stage Docker build

**Frontend:**
- `src/pages/` – Dashboard, Focus, Insights, Schedule, Templates
- `src/pages/auth_pages/` – Login, SignUp, ResetPassword, ForgotPassword
- `src/components/` – Navbar, ProtectedRoute
- `src/lib/api.ts` – Axios API client
- `frontend/Dockerfile` – Multi-stage Docker build
- `vite.config.js` – Dev and build config

---

## API Overview

All endpoints require authentication via Bearer token.

**Sessions**: `/api/sessions` - CRUD for session templates  
**Timer**: `/api/timer/start|pause|resume|stop` - Timer controls  
**Schedule**: `/api/schedule` - Calendar scheduling  
**Dashboard**: `/api/dashboard/overview|streak|stats` - Overview of the sessions  
**Insights**: `/api/insights/completed-sessions|analyze` - Analytics of sessions using sentiment analysis

---

## Database Overview

SQLite database (`pomodoro.db`) is auto-generated on first run with tables:
- `sessions`:  Session templates
- `timer_sessions`: Timer records with sentiment tracking
- `scheduled_sessions`: Calendar events

